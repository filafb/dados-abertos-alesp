language: node_js
node_js:
  - node # uses most recent stable node version
services:
  - postgresql # starts up postgres
addons:
  postgresql: '9.6' # highest available postgres version on Travis
dist: trusty # uses trusty environment
sudo: false # when on trusty, uses Docker containers for speed
notifications:
  email:
    on_success: change # default: change (only when going from broken to fixed)
    on_failure: always # default: always (which is annoying, as it should be)
install:
  - npm ci # faster, goes only from package-lock
before_script:
  - psql -c 'create database "dados-abertos-test";' -U postgres # remember to change this name if you change it elsewhere (e.g. package.json)

before_deploy:
  - npm run build-client # make the bundle
  - rm -rf node_modules # omit from the tarball, since we skip cleanup
deploy:
  skip_cleanup: true # prevents travis from deleting the build
  provider: heroku
  app: staging-alesp-dados-abertos # see README
  api_key:
    secure: W/fmQlCGbHjfXK1OnIrjkIcHn1WJOey+1ovMFdHF/2GKCmH4C4IZXcVErnEH5hhQ176R5+SSmB21MHRZR7bQJTYJ86tk+xGit/cdYTSd2P8c28mznfHQp+No6JXDI5powiPkYtctjc6E8jWXRfuQ346vKNroHi/xA2CQslBUMwpzRpAuQ03V1DR/sULIrmydtbMFf6ceicSYIcixdzLC1mY13qpTnlM3jHA0LSREniBpco8bVkcPaa3kSs1gPAYx+902Yzkyrvf2eyR+VfMs8QNuHw4yl4+qx9nEWp2L7Lk3wY2N1EdMBzSuxPNcRqKeCwinzBAf9A8gEA8KIZgH4oQdkJtXLuIQtZLQ0Mj8hHxiUCx3Zb7er7b37YoT9Zh4B+EcIzs9UgrCFWtUAfQDD4Xl/j9Z9dwLl3leC7jszw2qmynObkaUgBAomMy5WeDncc6DU7A4QZ/cIi5b0jLbbUARaAU+kwaFJ2n1JDVP0d8ZAUBC0fqg/wLqt1VIajwEbAJHdE1KCNSji9WNu7WzCq+XE+1n7+zqFph50jueX4dP7j3kl1869xZk5pZPLUGE67zh1Y3t3wl0aAVN+rnh9YtnnszXyPM5fw7Jz0+D+2Dzf2LJl0A+bl+7ZgU4tj/GjIWhf89LeTHklFOYbp2BiAVL6vF2AjCot2Zf8ufhlF8=
